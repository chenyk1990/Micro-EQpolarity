# JiachenToc2Me
**JiachenToc2Me** is Jiachen Hu's code repository for polarity picking and focal mechanism analysis in Canada.

## Overview
This repository provides a comprehensive workflow for classifying focal mechanism types, conducting independent testing, plotting waveforms on focal mechanisms, and applying EQpolarity with models and data, all using the ToC2ME dataset.

## 1. Classify Focal Mechanism Types

### Description
This section provides the workflow for classifying focal mechanisms using the ToC2ME dataset after independent testing. It includes scripts to divide data into regions, filter based on event quality, and visualize focal mechanisms. Additionally, it supports 3D visualizations of seismic event distributions.

---

## 2. Independent Testing

### Description
This section provides the workflow for conducting independent testing of the ToC2ME dataset. The testing workflow ensures that the models we apply are reliable, with approximately 7000 events resolved by EQpolarity.

---

## 3. Plot Waveforms on Focal Mechanisms

### Description
This section provides scripts to plot waveforms on focal mechanism beachball diagrams. Using the classified focal mechanism types, this tool helps visualize waveforms and station locations to validate the correctness of the mechanism solutions. 

### Notes:
- In the ToC2ME dataset, waveform polarities are inverted.

---

## 4. EQpolarity Transfer Learning

### Description
This section shows the application of transfer learning using EQpolarity models on the ToC2ME dataset. You can review the confusion matrices for the different models we trained to see how well they perform.

---

## Gallery
Here are examples of the outputs produced by the workflow:

### Accuracy on Microseismic Events（ToC2ME）
- Accuracy for each model can be obtained from [Code_ToC2ME/EQpolarity_Transfer_learning/CCT_ToC2ME_TransferLearning_20240926_For_Test.ipynb](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/EQpolarity_Transfer_learning/CCT_ToC2ME_TransferLearning_20240926_For_Test.ipynb)

#### The models are as follows
- Blue: [model/SCSN/best_weigths_Binary_SCSN_Best.h5](https://github.com/chenyk1990/jiachenToc2Me/blob/main/model/SCSN/best_weigths_Binary_SCSN_Best.h5)
- Orange: [model/Texas/best_weigths_Binary_Texas_Transfer10.h5](https://github.com/chenyk1990/jiachenToc2Me/blob/main/model/Texas/best_weigths_Binary_Texas_Transfer10.h5)
- Red: [model/Toc2me_20240809_ Transfer_Learning_6982data/best_weigths_Binary_Toc2me_Transfer10_20240809_70%.h5](https://github.com/chenyk1990/jiachenToc2Me/blob/main/model/Toc2me_20240809_%20Transfer_Learning_6982data/best_weigths_Binary_Toc2me_Transfer10_20240809_70%25.h5)
![Accuracy on Microseismic Events（ToC2ME）](./Code_ToC2ME/EQpolarity_Transfer_learning/Model_Comparison_on_Microseismic_Events.png)

### EQpolarity Transfer Learning Confusion Matrix with Canada Best Model
- Generated by [Code_ToC2ME/EQpolarity_Transfer_learning/CCT_ToC2ME_TransferLearning_20240926_For_Test.ipynb](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/EQpolarity_Transfer_learning/CCT_ToC2ME_TransferLearning_20240926_For_Test.ipynb) with model [model/Toc2me_20240809_ Transfer_Learning_6982data/best_weigths_Binary_Toc2me_Transfer10_20240809_70%.h5](https://github.com/chenyk1990/jiachenToc2Me/blob/main/model/Toc2me_20240809_%20Transfer_Learning_6982data/best_weigths_Binary_Toc2me_Transfer10_20240809_70%25.h5)
![EQpolarity Transfer Learning Confusion Matrix](./Code_ToC2ME/EQpolarity_Transfer_learning/confusion_matrix.png)

### Independent testing – Focal Mechanisms
- Generated by [Code_ToC2ME/Independent_testing/Mapping.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Independent_testing/Mapping.py)
![Canada（ToC2ME） – Focal Mechanisms](./Code_ToC2ME/Independent_testing/Station_Locations_with_Focal_Mechanisms_Independent_testing_ToC2ME.png)

### Focal Mechanism Classification in ToC2ME
- Generated by [Code_ToC2ME/Classify_focal_mechanism_types/Mapping2.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Classify_focal_mechanism_types/Mapping2.py) with [ToC2ME data](https://doi.org/10.5281/zenodo.13902345) for `base_path`
![Focal Mechanism Classification - Grouped All Fault Types](./Code_ToC2ME/Classify_focal_mechanism_types/Grouped_all_Fault_Type.png)

#### Focal mechanisms on the right are generated by:
- Red: [Code_ToC2ME/Classify_focal_mechanism_types/group1/plot_mechanism_group1.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Classify_focal_mechanism_types/group1/plot_mechanism_group1.py) 
- Blue: [Code_ToC2ME/Classify_focal_mechanism_types/group2/plot_mechanism_group2.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Classify_focal_mechanism_types/group2/plot_mechanism_group2.py)
- Green: [Code_ToC2ME/Classify_focal_mechanism_types/group3/plot_mechanism_group3.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Classify_focal_mechanism_types/group3/plot_mechanism_group3.py) 
![Focal Mechanism Classification - Figure](./Code_ToC2ME/Classify_focal_mechanism_types/Figure.png)

### 3D Visualization of Seismic Events for Group2
- Generated by [Code_ToC2ME/Classify_focal_mechanism_types/Mapping4_3D.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Classify_focal_mechanism_types/Mapping4_3D.py)
![3D Event Distribution](./Code_ToC2ME/Classify_focal_mechanism_types/3D_Plot_of_Normal_Fault_with_Time_Gradient.png)

### Waveforms on Focal Mechanisms
- Generated by [Code_ToC2ME/Plot_waveform_on_mechanisms/Focal_mechanism_with_waveform_individually.py](https://github.com/chenyk1990/jiachenToc2Me/blob/main/Code_ToC2ME/Plot_waveform_on_mechanisms/Focal_mechanism_with_waveform_individually.py)
![Waveforms on Focal Mechanisms](./Code_ToC2ME/Plot_waveform_on_mechanisms/Group_with_waveform.png)

---

## Data
1. ToC2ME data: https://doi.org/10.5281/zenodo.13902345

2. Texas data: Google Drive link: https://drive.google.com/drive/folders/1WXVB8ytNB4bOaZ97oq6OmMRyAEg95trp?usp=sharing

3. Texas_22980 data: https://doi.org/10.5281/zenodo.13901460

4. ToC2ME_Testing_data: In the `data` folder

---

## Environment Setup

To create and set up the required environment, follow these steps:

```bash
# Step 1: Create a Conda environment with Python 3.11.7
conda create -n eqp python=3.11.7

# Step 2: Activate the Conda environment
conda activate eqp

# Step 3: Install Jupyter Notebook
conda install ipython notebook

# Step 4: Install additional dependencies
pip install matplotlib==3.8.0 tensorflow==2.14.0 scikit-learn==1.2.2 seaborn==0.13.2
